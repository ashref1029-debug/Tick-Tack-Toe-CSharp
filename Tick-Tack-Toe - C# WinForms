using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace Tick_Tack_project
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }
        enPlayer player = enPlayer.player1;
        stGameStatus GameStatus;

        enum enPlayer { player1, player2 }
        enum enWinner { player1, player2, Draw, InPrograss }
        struct stGameStatus
        {
            public enWinner winner;
            public short playCount;
            public bool GameOver;
        }
        private void EndGame()
        {
            LbTurn.Text = "Game Over";

            switch (GameStatus.winner)
            {
                case enWinner.player1: LbWinner.Text = "Player 1"; break;
                case enWinner.player2: LbWinner.Text = "Player 2"; break;
                default: LbWinner.Text = "Draw"; break;

            }

            MessageBox.Show("GameOver", "GameOver", MessageBoxButtons.OK, MessageBoxIcon.Information);

        }
        private bool CheckValues(Button bt1, Button bt2, Button bt3)
        {
            if (bt1.Tag.ToString() != "@" & bt1.Tag.ToString() == bt2.Tag.ToString() && bt2.Tag.ToString() == bt3.Tag.ToString())
            {
                bt1.BackColor = Color.Yellow;
                bt2.BackColor = Color.Yellow;
                bt3.BackColor = Color.Yellow;



                if (bt1.Tag.ToString() == "X")
                {
                    GameStatus.winner = enWinner.player1;
                }
                else GameStatus.winner = enWinner.player2;

                GameStatus.GameOver = true;
                EndGame();
                return true;
            }


            return false;
        }

        private void CheckWinner()
        {
            if (CheckValues(bt1, bt2, bt3)) return;
            if (CheckValues(bt4, bt5, bt6)) return;
            if (CheckValues(bt7, bt8, bt9)) return;

            if (CheckValues(bt1, bt4, bt7)) return;
            if (CheckValues(bt2, bt5, bt8)) return;
            if (CheckValues(bt3, bt6, bt9)) return;

            if (CheckValues(bt1, bt5, bt9)) return;
            if (CheckValues(bt3, bt5, bt7)) return;

            if (GameStatus.playCount == 9)
            {
                GameStatus.GameOver = true;
                GameStatus.winner = enWinner.Draw;
                EndGame();
            }
        }

        private void CheckImage(Button bt)
        {

            if (bt.Tag.ToString() == "@")
            {
                GameStatus.playCount++;


                if (player == enPlayer.player1)
                {
                    bt.BackgroundImage = Properties.Resources.X;
                    bt.Tag = "X";

                    LbTurn.Text = "Player 2";
                    player = enPlayer.player2;
                    CheckWinner();

                    return;
                }
                else
                {
                    bt.BackgroundImage = Properties.Resources.O;
                    bt.Tag = "O";

                    LbTurn.Text = "Player 1";
                    player = enPlayer.player1;
                    CheckWinner();

                    return;
                }
            }
            else
                MessageBox.Show("Wrong Choices", "Wrong Choices", MessageBoxButtons.OK, MessageBoxIcon.Information);

        }


        private void StartGame(object sender, MouseEventArgs e)
        {
            if (GameStatus.GameOver)
            {
                MessageBox.Show("Game Over you can click on restart to play again", "Wrong Choices", MessageBoxButtons.OK, MessageBoxIcon.Information);
                return;

            }

            CheckImage((Button)sender);

        }
        private void RestButton(Button bt)
        {
            bt.BackgroundImage = Properties.Resources.images;
            bt.Tag = "@";
            bt.BackColor = Color.Black;
        }
        private void RestGame()
        {
            player = enPlayer.player1;

            GameStatus.winner = enWinner.InPrograss;
            GameStatus.playCount = 0;
            GameStatus.GameOver = false;

            LbWinner.Text = "In Progress";
            LbTurn.Text = "Player 1";

            RestButton(bt1);
            RestButton(bt2);
            RestButton(bt3);
            RestButton(bt4);
            RestButton(bt5);
            RestButton(bt6);
            RestButton(bt7);
            RestButton(bt8);
            RestButton(bt9);
        }

        private void Form1_Load(object sender, EventArgs e)
        {
            RestGame();
        }

      

        private void Form1_Paint_1(object sender, PaintEventArgs e)
        {
            Color Lcolor = Color.White;
            Pen pen = new Pen(Lcolor);
            pen.Width = 5;

            pen.DashStyle = System.Drawing.Drawing2D.DashStyle.Dash;

            pen.StartCap = System.Drawing.Drawing2D.LineCap.Round;
            pen.EndCap = System.Drawing.Drawing2D.LineCap.Round;

            e.Graphics.DrawLine(pen, 400, 100, 700, 100);
            e.Graphics.DrawLine(pen, 400, 170, 700, 170);
            e.Graphics.DrawLine(pen, 400, 230, 700, 230);
            e.Graphics.DrawLine(pen, 400, 300, 700, 300);


            e.Graphics.DrawLine(pen, 400, 100, 400, 300);
            e.Graphics.DrawLine(pen, 500, 100, 500, 300);
            e.Graphics.DrawLine(pen, 600, 100, 600, 300);
            e.Graphics.DrawLine(pen, 700, 100, 700, 300);
        }

        private void btRestGame_Click_1(object sender, EventArgs e)
        {
            RestGame();
        }
    }
}
